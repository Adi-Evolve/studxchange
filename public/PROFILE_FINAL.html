<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile - StudXchange</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" />
  <script src="js/db-config.js"></script>
  <style>
    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      color: #333;
    }
    header {
      background-color: #2a3d56;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .account-container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .account-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .account-header h1 {
      font-size: 24px;
      color: #2a3d56;
    }
    .account-actions button {
      background-color: #2a3d56;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .account-actions button:hover {
      background-color: #4d6a88;
    }
    .profile-info, .order-history, .sold-items, .settings {
      margin-bottom: 20px;
    }
    .profile-info h2, .order-history h2, .sold-items h2, .settings h2 {
      font-size: 22px;
      color: #2a3d56;
      margin-bottom: 10px;
    }
    .profile-item {
      margin: 10px 0;
    }
    .profile-item strong {
      color: #2a3d56;
    }
    .order-history ul, .sold-items ul {
      list-style-type: none;
      padding: 0;
    }
    .order-history li, .sold-items li {
      margin: 8px 0;
    }
    .settings button {
      background-color: #2a3d56;
      padding: 10px 20px;
      color: white;
      border: none;
      border-radius: 8px;
      margin-right: 15px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .settings button:hover {
      background-color: #4d6a88;
    }
    footer {
      background-color: #124559;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .phone-button {
      margin-left: 10px;
      padding: 5px 10px;
      background: #2a3d56;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .listed-items {
      margin-bottom: 30px;
    }
    .listed-item {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 15px;
      transition: transform 0.2s ease;
    }
    .listed-item:hover {
      transform: translateX(5px);
    }
    .item-image {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 4px;
      margin-right: 20px;
    }
    .item-details {
      flex-grow: 1;
    }
    .item-actions {
      display: flex;
      gap: 12px;
    }
    .sold-btn, .delete-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      color: white;
    }
    .sold-btn {
      background-color: #28a745 !important;
      border: 1px solid #218838;
    }
    .sold-btn:hover {
      background-color: #218838 !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .delete-btn {
      background-color: #dc3545 !important;
      border: 1px solid #c82333;
    }
    .delete-btn:hover {
      background-color: #c82333 !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 400px;
      border-radius: 8px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
    /* Updated Modal Button Styles */
    .modal-content button {
      background-color: #2a3d56;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .modal-content button:hover {
      background-color: #4d6a88;
    }
    
    /* Navbar styles for consistency */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #2a3d56;
      padding: 15px 30px;
      /* box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); */
      border: none;
    }
    .navlogo img {
      height: 100px;
      width: 250px;
    }
    .search-container {
      flex: 1;
      display: flex;
      justify-content: center;
      margin: 0 20px;
    }
    .searchbar {
      display: flex;
      align-items: center;
      background: white;
      border-radius: 30px;
      padding: 2px;
      width: 100%;
      max-width: 600px;
    }
    .nav-button {
      padding: 10px 25px;
      border-radius: 25px;
      text-decoration: none;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      font-weight: 500;
      display: inline-block;
      color: white;
    }
    .location-button {
      background-color: #28a745 !important;
      margin-right: 10px;
    }
    @media (max-width: 768px) {
    .searchbar select {
        padding: 8px;
        font-size: 14px;
    }
}
.searchbar select {
    background: #2a3d56;
    color: white;
    border-radius: 30px 0 0 30px;
}
.searchbar select, .searchbar input, .searchbar button {
    border: none;
    padding: 10px;
}
@media (max-width: 768px) {
    .searchbar select {
        padding: 8px;
        font-size: 14px;
    }
}
select {
    word-wrap: normal;
}
button, select {
    text-transform: none;
}
button, input, optgroup, select, textarea {
    margin: 0;
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
}
select {
    word-wrap: normal;
}
button, select {
    text-transform: none;
}
button, input, optgroup, select, textarea {
    margin: 0;
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
}
@media (max-width: 768px) {
    .searchbar input {
        font-size: 14px;
    }
}
.searchbar input {
    width: 100%;
}
.searchbar select, .searchbar input, .searchbar button {
    border: none;
    padding: 10px;
}

@media (max-width: 768px) {
    .searchbar input {
        font-size: 14px;
    }
}
.searchbar button {
    background: #2a3d56;
    color: white;
    border-radius: 0 30px 30px 0;
}
button, select {
    text-transform: none;
}
    /* UI improvements and effects for consistency */
    .listed-item {
      box-shadow: 0 2px 8px rgba(42,61,86,0.08);
      transition: transform 0.22s cubic-bezier(.4,2,.6,1), box-shadow 0.22s cubic-bezier(.4,2,.6,1);
      background: linear-gradient(90deg, #f4f6f9 80%, #e8ecf4 100%);
      border: 1.5px solid #e1e7f0;
    }
    .listed-item:hover {
      transform: scale(1.025) translateX(8px);
      box-shadow: 0 6px 20px rgba(42,61,86,0.16);
      background: linear-gradient(90deg, #e8ecf4 80%, #f4f6f9 100%);
    }
    .sold-label {
      background: #dc3545;
      color: #fff;
      font-weight: bold;
      padding: 7px 16px;
      border-radius: 16px;
      font-size: 1rem;
      letter-spacing: 1px;
      margin-left: 10px;
      box-shadow: 0 2px 8px rgba(220,53,69,0.18);
    }
    .sold-effect {
      opacity: 0.8;
      filter: grayscale(0.25) blur(0.5px);
      border-left: 4px solid #dc3545;
    }
    .item-details h3 {
      font-size: 1.18rem;
      color: #2a3d56;
      margin-bottom: 3px;
      font-weight: 600;
      letter-spacing: 0.2px;
    }
    .item-details p {
      font-size: 1.02rem;
      color: #1a75ff;
      margin-bottom: 0;
      font-weight: 500;
    }
    .item-image {
      border: 2px solid #e1e7f0;
      box-shadow: 0 2px 8px rgba(42,61,86,0.04);
      transition: box-shadow 0.22s cubic-bezier(.4,2,.6,1);
    }
    .listed-item:hover .item-image {
      box-shadow: 0 6px 20px rgba(42,61,86,0.10);
      border-color: #b3c6e0;
    }
    .sold-effect .item-image {
      border-color: #dc3545;
    }
    .sold-btn, .delete-btn {
      font-size: 1rem;
      border-radius: 24px;
      padding: 8px 18px;
      margin-left: 2px;
      margin-right: 2px;
      box-shadow: 0 2px 8px rgba(42,61,86,0.10);
      transition: background 0.2s, box-shadow 0.2s;
    }
    .sold-btn:hover {
      background: #1a75ff !important;
      color: #fff;
      box-shadow: 0 4px 16px rgba(26,117,255,0.16);
    }
    .delete-btn:hover {
      background: #ff1744 !important;
      color: #fff;
      box-shadow: 0 4px 16px rgba(255,23,68,0.16);
    }
    /* Consistent section spacing */
    .account-container > div, .account-details > div {
      margin-bottom: 34px !important;
    }
    /* Responsive tweaks */
    @media (max-width: 600px) {
      .listed-item { flex-direction: column; align-items: flex-start; }
      .item-image { width: 96vw; max-width: 330px; height: 180px; margin-bottom: 10px; }
      .item-details { width: 100%; }
      .item-actions { width: 100%; justify-content: flex-end; }
    }
  </style>
</head>
<body>
  <!-- Common Navbar -->
  <header>
    <div class="navbar">
        <div class="navlogo">
            <a href="index.html"><img src="Logo1.png" alt="StudXchange"></a>
        </div>
        <div class="search-container">
            <form class="searchbar" action="search-results.html" method="GET">
                <select name="category">
                    <option value="all">All</option>
                    <option value="VIT">VIT</option>
                    <option value="COEP">COEP</option>
                    <option value="PICT">PICT</option>
                    <option value="DYP">DYP</option>
                    <option value="PCCOE">PCCOE</option>
                </select>
                <input type="text" name="query" placeholder="Search products...">
                <button type="submit"><i class="fas fa-search"></i></button>
            </form>
        </div>
        <button class="nav-button location-button" id="locationButton">
            <i class="fas fa-map-marker-alt"></i> 
            <span id="locationText">Get Location</span>
        </button>
        <span id="locationStatus" class="location-status"></span>
        <div class="button-container" style="display: flex;">
            <a class="nav-button wishlist-button me-2" href="wishlist.html">
                <i class="far fa-heart"></i>
            </a>
            <a class="nav-button sell-button" href="sell.html">Sell/Donate</a>
            <!-- <div id="authButtonContainer"></div> -->

        </div>
    </div>
</header>

  <div class="account-container">
      <header class="account-header">
          <h1 style="color: white;">Welcome, <span id="userName" style="color: white;"></span></h1>
          <div class="account-actions">
              <button onclick="openEditProfileModal()">Edit Profile</button>
              <button onclick="logout()">Logout</button>
          </div>
      </header>

      <div class="account-details">
          <!-- Profile Information Section -->
          <div class="profile-info">
              <h2>Profile Information</h2>
              <div class="profile-item">
                  <strong>Name:</strong> <span id="profileName"></span>
              </div>
              <div class="profile-item">
                  <strong>Email:</strong> <span id="profileEmail"></span>
              </div>
              <div class="profile-item">
                  <strong>Phone:</strong> 
                  <span id="profilePhone"></span>
                  <button id="addPhoneBtn" class="phone-button" onclick="openPhoneModal()">Add Phone Number</button>
              </div>
          </div>

          <!-- Listed Items Section -->
          <div class="listed-items">
              <h2>My Listed Items</h2>
              <ul id="listedItemsList"></ul>
          </div>

          <!-- Order History Section -->
          <div class="order-history">
              <h2>Last Orders</h2>
              <ul id="orderList"></ul>
          </div>

          <!-- Sold Items Section -->
          <div class="sold-items">
              <h2>Sold Items</h2>
              <ul id="soldItemsList"></ul>
          </div>

          <!-- Account Settings Section -->
          <div class="settings">
              <h2>Account Settings</h2>
          </div>
      </div>
  </div>

  <footer>
    <div class="footer-container">
      <div class="footer-brand">
        <img src="Logo1.png" alt="StudXchange" style="height: 60px; margin-bottom: 8px;">
        <h3>StudXchange</h3>
        <p>Empowering students to buy, sell, and exchange with ease.</p>
      </div>
      <div class="footer-links">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="category.html">Categories</a></li>
          <li><a href="sell.html">Sell/Donate</a></li>
          <li><a href="PROFILE_FINAL.html">Profile</a></li>
          <li><a href="wishlist.html">Wishlist</a></li>
        </ul>
      </div>
      <div class="footer-contact">
        <h4>Contact</h4>
        <p>Email: <a href="mailto:DON_Agency@gmail.com">DON_Agency@gmail.com</a></p>
        <p>Phone: 8857053541</p>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2025 StudXchange. All rights reserved.
    </div>
  </footer>
  <style>
    footer {
      background-color: #232f3e;
      color: #fff;
      padding: 40px 0 0 0;
      margin-top: 40px;
    }
    .footer-container {
      max-width: 1200px;
      margin: auto;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 30px;
      padding: 0 20px;
    }
    .footer-brand {
      flex: 1 1 220px;
      text-align: center;
    }
    .footer-brand h3 {
      margin-top: 8px;
      margin-bottom: 8px;
      color: #ffb300;
    }
    .footer-links {
      flex: 1 1 180px;
    }
    .footer-links ul {
      list-style: none;
      padding: 0;
    }
    .footer-links li {
      margin-bottom: 10px;
    }
    .footer-links a {
      color: #fff;
      text-decoration: none;
      transition: color 0.2s;
    }
    .footer-links a:hover {
      color: #ffb300;
    }
    .footer-contact {
      flex: 1 1 180px;
    }
    .footer-contact a {
      color: #ffb300;
      text-decoration: none;
    }
    .footer-bottom {
      text-align: center;
      padding: 18px 0 8px 0;
      font-size: 1rem;
      border-top: 1px solid #39495a;
      margin-top: 32px;
      background: #1a232e;
    }
    @media (max-width: 800px) {
      .footer-container {
        flex-direction: column;
        align-items: center;
      }
      .footer-brand, .footer-links, .footer-contact {
        text-align: center;
      }
    }
  </style>

  <!-- Phone Modal -->
  <div id="phoneModal" class="modal">
      <div class="modal-content">
          <span class="close" onclick="closePhoneModal()">&times;</span>
          <h2>Enter Phone Number</h2>
          <input type="tel" id="newPhone" placeholder="Enter 10-digit number" pattern="[0-9]{10}" required>
          <button onclick="savePhone()">Save</button>
      </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="editProfileModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeEditProfileModal()">&times;</span>
      <h2>Edit Profile</h2>
      <form id="editProfileForm">
        <label for="editName">Name:</label>
        <input type="text" id="editName" name="editName" required><br><br>
        <label for="editPhone">Phone:</label>
        <input type="tel" id="editPhone" name="editPhone" pattern="[0-9]{10}" required><br><br>
        <button type="submit">Save Changes</button>
      </form>
    </div>
  </div>

  <script src="js/navbar.js"></script>
  <script>
    // When the page loads, load user data from localStorage and display profile info.
    document.addEventListener('DOMContentLoaded', () => {
        // Check if user is logged in
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        if (!isLoggedIn) {
            console.log('User not logged in, redirecting to login page');
            window.location.href = 'login.html';
            return;
        }
        
        const user = JSON.parse(localStorage.getItem('currentUser'));
        if (user) {
            console.log('User data found in localStorage:', user.email);
            document.getElementById('userName').textContent = user.name || 'User';
            document.getElementById('profileName').textContent = user.name || 'Not provided';
            document.getElementById('profileEmail').textContent = user.email || 'Not provided';
            
            if (user.phone) {
                document.getElementById('profilePhone').textContent = user.phone;
                document.getElementById('addPhoneBtn').style.display = 'none';
            } else {
                document.getElementById('profilePhone').textContent = 'Not provided';
                document.getElementById('addPhoneBtn').style.display = 'inline-block';
            }
            
            // Load user's items
            loadListedItems();
            loadSoldItems();
        } else {
            console.error('No user data found despite being logged in');
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'login.html';
        }
    });

    // Phone Modal functions
    function openPhoneModal() {
        document.getElementById('phoneModal').style.display = 'block';
    }
    
    function closePhoneModal() {
        document.getElementById('phoneModal').style.display = 'none';
    }

    async function savePhone() {
        const newPhone = document.getElementById('newPhone').value.trim();
        if (!newPhone.match(/^\d{10}$/)) {
            alert('Please enter a valid 10-digit phone number');
            return;
        }
        try {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            currentUser.phone = newPhone;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Update user in MongoDB
            const response = await fetch(API_ENDPOINTS.UPDATE_USER, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: currentUser.email,
                    phone: newPhone
                })
            });
            
            if (!response.ok) {
                throw new Error('Failed to update phone number');
            }
            
            document.getElementById('profilePhone').textContent = newPhone;
            document.getElementById('addPhoneBtn').style.display = 'none';
            closePhoneModal();
        } catch (error) {
            console.error('Error saving phone:', error);
            alert('Failed to save phone number');
        }
    }

    async function loadListedItems() {
        try {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || !currentUser.email) {
                console.error('No user email found in localStorage');
                document.getElementById('listedItemsList').innerHTML = '<p>Please log in to view your listed items.</p>';
                return;
            }
            document.getElementById('listedItemsList').innerHTML = '<p>Loading your items...</p>';
            // Fetch all products, notes, and rooms listed by the user
            const [productsRes, notesRes, roomsRes] = await Promise.all([
                fetch(`${API_ENDPOINTS.GET_PRODUCTS}?sellerEmail=${encodeURIComponent(currentUser.email)}`),
                fetch(`${API_ENDPOINTS.GET_NOTES}?sellerEmail=${encodeURIComponent(currentUser.email)}`),
                fetch(`${API_ENDPOINTS.GET_ROOMS}?sellerEmail=${encodeURIComponent(currentUser.email)}`)
            ]);
            if (!productsRes.ok && !notesRes.ok && !roomsRes.ok) {
                throw new Error('Failed to fetch any listed items');
            }
            const products = productsRes.ok ? await productsRes.json() : [];
            const notes = notesRes.ok ? await notesRes.json() : [];
            const rooms = roomsRes.ok ? await roomsRes.json() : [];
            const allItems = [...products, ...notes, ...rooms];
            const listedItems = document.getElementById('listedItemsList');
            listedItems.innerHTML = '';
            if (allItems.length === 0) {
                listedItems.innerHTML = '<p>You have no listed items.</p>';
                return;
            }
            allItems.forEach(item => {
                listedItems.innerHTML += `
                    <li class="listed-item">
                        <img src="${item.images?.[0] || item.image || 'placeholder.jpg'}" class="item-image" alt="${item.title || item.roomType || 'Item'}">
                        <div class="item-details">
                            <h3>${item.title || item.roomType || 'Untitled Item'}</h3>
                            <p>₹${item.price || item.deposit || '0'}</p>
                        </div>
                        <div class="item-actions">
                            <button class="sold-btn" onclick="handleSold('${item._id}')">Mark Sold</button>
                            <button class="delete-btn" onclick="deleteItem('${item._id}')">Remove</button>
                        </div>
                    </li>
                `;
            });
        } catch (error) {
            console.error('Error loading items:', error);
            document.getElementById('listedItemsList').innerHTML = `<p>Failed to load your listed items: ${error.message}</p>`;
        }
    }

    async function loadSoldItems() {
        try {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || !currentUser.email) {
                console.error('No user email found in localStorage');
                document.getElementById('soldItemsList').innerHTML = '<p>Please log in to view your sold items.</p>';
                return;
            }
            document.getElementById('soldItemsList').innerHTML = '<p>Loading your sold items...</p>';
            // Fetch only sold products for the user
            const response = await fetch(`${API_ENDPOINTS.GET_SOLD_ITEMS}?sellerEmail=${encodeURIComponent(currentUser.email)}`);
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                console.error('Failed to fetch sold items:', response.status, errorData);
                throw new Error(errorData.message || 'Failed to fetch sold items');
            }
            const soldItems = await response.json();
            const soldItemsList = document.getElementById('soldItemsList');
            soldItemsList.innerHTML = '';
            if (soldItems.length === 0) {
                soldItemsList.innerHTML = '<p>You have no sold items.</p>';
                return;
            }
            soldItems.forEach(item => {
                soldItemsList.innerHTML += `
                    <li class="listed-item sold-effect">
                        <img src="${item.images?.[0] || item.image || 'placeholder.jpg'}" class="item-image" alt="${item.title || 'Product'}">
                        <div class="item-details">
                            <h3>${item.title || 'Untitled Product'}</h3>
                            <p>₹${item.price || '0'}</p>
                        </div>
                        <div class="item-actions">
                            <span class="sold-label">SOLD</span>
                        </div>
                    </li>
                `;
            });
        } catch (error) {
            console.error('Error loading sold items:', error);
            document.getElementById('soldItemsList').innerHTML = `<p>Failed to load your sold items: ${error.message}</p>`;
        }
    }

    async function deleteItem(productId) {
        if (!confirm('Are you sure you want to delete this item?')) return;
        try {
            const response = await fetch(`${API_ENDPOINTS.DELETE_PRODUCT(productId)}`, {
                method: 'DELETE'
            });
            
            if (!response.ok) {
                throw new Error('Failed to delete item');
            }
            
            await loadListedItems();
            alert('Item deleted successfully!');
        } catch (error) {
            console.error('Delete error:', error);
            alert('Failed to delete item');
        }
    }

    async function handleSold(productId) {
        if (!confirm('Mark this item as sold?')) return;
        try {
            const response = await fetch(`${API_ENDPOINTS.MARK_SOLD}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId })
            });
            
            if (!response.ok) {
                throw new Error('Failed to mark item as sold');
            }
            
            await loadListedItems();
            await loadSoldItems();
            alert('Item marked as sold!');
        } catch (error) {
            console.error('Error marking as sold:', error);
            alert('Failed to mark item as sold');
        }
    }

    function openEditProfileModal() {
      const user = JSON.parse(localStorage.getItem('currentUser'));
      document.getElementById('editName').value = user.name || '';
      document.getElementById('editPhone').value = user.phone || '';
      document.getElementById('editProfileModal').style.display = 'block';
    }
    function closeEditProfileModal() {
      document.getElementById('editProfileModal').style.display = 'none';
    }
    document.getElementById('editProfileForm').onsubmit = async function(e) {
      e.preventDefault();
      const newName = document.getElementById('editName').value.trim();
      const newPhone = document.getElementById('editPhone').value.trim();
      if (!newName || !/^\d{10}$/.test(newPhone)) {
        alert('Please enter a valid name and 10-digit phone number');
        return;
      }
      try {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        // Update in MongoDB
        const response = await fetch(API_ENDPOINTS.UPDATE_USER, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: currentUser.email, name: newName, phone: newPhone })
        });
        if (!response.ok) throw new Error('Failed to update profile');
        // Update localStorage
        currentUser.name = newName;
        currentUser.phone = newPhone;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        // Update UI
        document.getElementById('userName').textContent = newName;
        document.getElementById('profileName').textContent = newName;
        document.getElementById('profilePhone').textContent = newPhone;
        document.getElementById('addPhoneBtn').style.display = 'none';
        closeEditProfileModal();
        alert('Profile updated successfully!');
      } catch (err) {
        alert('Failed to update profile: ' + err.message);
      }
    };

    // Other account actions
    function logout() {
        localStorage.removeItem('currentUser');
        window.location.href = 'login.html';
    }
  </script>
</body>
</html>
